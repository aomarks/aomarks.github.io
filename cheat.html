<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>aomarks / cheatsheet</title>
<meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
<style>
[hidden] {
  display: none;
}
.prompt::before {
  content: "$ ";
}
#filter {
 position: fixed;
 right: 10px;
 top: 10px;
}
kbd {
  font-family: monospace;
  background-color: whitesmoke;
  border: 1px solid lightgray;
  padding: 1px 5px;
  border-radius: 4px;
}
td:first-of-type {
  text-align: right;
}
th > h4 {
  text-align: left;
  font-weight: normal;
  font-size: 18px;
}
</style>
</head>

<body>
<a href="/">index</a>

<p>Latest update: January 22, 2020</p>

<h3><a id="urxvt" href="#urxvt">urxvt</a></h3>
<ol>

<li item>
<p>Copy to CLIPBOARD selection:</p>
<code>ALT+SHIFT+C</code>
</li>

<li item>
<p>Paste from CLIPBOARD selection:</p>
<code>ALT+SHIFT+V</code>
</li>

<li item>
<p>Rectangular selection:</p>
  <code>ALT+SELECT</code>
</li>

<li item>
<p>Search scrollback:</p>
<code>ALT+S</code>
</li>

</ol>

<h3><a id="debian" href="#debian">Debian</a></h3>
<ol>

<li item>
<p>List manually installed Debian packages:</p>
<code><span class="prompt"></span>sudo grep -oP "Unpacking \K[^: ]+" /var/log/installer/syslog | sort -u | comm -13 /dev/stdin &lt;(apt-mark showmanual | sort)</code>
</li>

</ol>

<h3><a id="git" href="#git">Git</a></h3>
<ol>

<li item>
<p>Reset the date of the last commit:</p>
<code><span class="prompt"></span>git commit --amend --date "$(date -R)"</code>
</li>

</ol>

<h3><a id="macOS" href="#macOS">macOS</a></h3>

<h4>Keyboard symbols</h4>
<table>
  <tr item><td>⌘</td> <td>Command</td></tr>
  <tr item><td>⌥</td> <td>Option</td></tr>
  <tr item><td>⌃</td> <td>Control</td></tr>
  <tr item><td>⇧</td> <td>Shift</td></tr>
  <tr item><td>⇪</td> <td>Caps Lock</td></tr>
</table>

<h3><a id="vscode" href="#vscode">VSCode</a></h3>

<h4>Keyboard shortcuts</h4>

<table>
  <tr item>
    <td>Ctrl + Shift + P</td>
    <td>Show Command Palette</td>
  </tr>
  <tr item>
    <td>Shift + Alt + →</td>
    <td>Expand selection</td>
  </tr>
  <tr item>
    <td>Shift + Alt + ←</td>
    <td>Shrink selection</td>
  </tr>
  <tr item><td>Alt + ↑</td><td>Move line up</td></tr>
  <tr item><td>Alt + ↓</td><td>Move line down</td></tr>
  <tr item><td>Ctrl + Alt + Shift + ↓</td><td>Duplicate line down</td></tr>
  <tr item><td>Ctrl + /</td><td>Toggle line comment</td></tr>
  <tr item><td>Alt + Z</td><td>Toggle word wrap</td></tr>
</table>

<h3>Vim</h3>

<style>
  main {
    column-width: 250px;
    column-gap: 20px;
  }
  main > section {
    column-fill: all;
    break-inside: avoid;
  }
  ul {
    list-style: none;
    padding-left: 0;
    display: table;
    border-spacing: 0 8px;
    margin: 0;
  }
  li {
    display: table-row;
  }
  li > kbd, dfn {
    display: table-cell;
  }
  dfn {
    padding-left: 10px;
  }
  section {
    background-color: whitesmoke;
    margin: 20px 0;
    border-radius: 10px;
    padding: 5px;
    font-family: sans-serif;
    font-size: 14px;
  }
  h4 {
    font-size: 18px;
    font-family: sans-serif;
    font-weight: normal;
    margin-top: 0;
    margin-bottom: 10px;
    color: #616161;
  }
  dfn {
    font-style: normal;
  }
</style>

<main>

<section>
<h4>Files</h4>
<ul>
<li item><kbd>:w</kbd>   <dfn>Write file</dfn></li>
<li item><kbd>:wqa</kbd> <dfn>Write all files</dfn></li>
<li item><kbd>:q</kbd>   <dfn>Quit unless pending changes</dfn></li>
<li item><kbd>:q!</kbd>  <dfn>Quit and ignore pending changes</dfn></li>
</ul>
</section>

<section>
<h4>Basic navigation</h4>
<ul>
<li item><kbd>h</kbd> <dfn>Left</dfn></li>
<li item><kbd>j</kbd> <dfn>Down</dfn></li>
<li item><kbd>k</kbd> <dfn>Up</dfn></li>
<li item><kbd>l</kbd> <dfn>Right</dfn></li>
</ul>
</section>

<section>
<h4>Words</h4>
<ul>
<li item><kbd>w</kbd> <dfn>Start of next word</dfn></li>
<li item><kbd>W</kbd> <dfn>Start of next word (with punctuation)</dfn></li>
<li item><kbd>b</kbd> <dfn>Start of last word</dfn></li>
<li item><kbd>B</kbd> <dfn>Start of last word (with punctuation)</dfn></li>
<li item><kbd>e</kbd> <dfn>End of next word</dfn></li>
<li item><kbd>E</kbd> <dfn>End of next word (with punctuation)</dfn></li>
</ul>
</section>

<section>
<h4>Scrolling</h4>
<ul>
<li item><kbd><kbd>Ctrl</kbd> + <kbd>e</kbd></kbd> <dfn>Scroll one line down</dfn></li>
<li item><kbd><kbd>Ctrl</kbd> + <kbd>y</kbd></kbd> <dfn>Scroll one line up</dfn></li>
<li item><kbd><kbd>Ctrl</kbd> + <kbd>d</kbd></kbd> <dfn>Scroll half screen down</dfn></li>
<li item><kbd><kbd>Ctrl</kbd> + <kbd>u</kbd></kbd> <dfn>Scroll half screen up</dfn></li>
<li item><kbd><kbd>Ctrl</kbd> + <kbd>f</kbd></kbd> <dfn>Scroll full screen down</dfn></li>
<li item><kbd><kbd>Ctrl</kbd> + <kbd>b</kbd></kbd> <dfn>Scroll full screen up</dfn></li>
<li item><kbd>zz</kbd>                  <dfn>Scroll so that current line is centered</dfn></li>
</ul>
</section>

<section>
<h4>Navigate lines</h4>
<ul>
<li item><kbd>0</kbd> <dfn>line start</dfn></li>
<li item><kbd>$</kbd> <dfn>line end</dfn></li>
<li item><kbd><kbd>^</kbd> or <kbd>_</kbd></kbd> <dfn>first non-blank character of line</dfn></li>
<li item><kbd>g_</kbd> <dfn>last non-blank character of line</dfn></li>
</ul>
</section>

<section>
<h4>Navigate screen</h4>
<ul>
<li item><kbd>h</kbd> <dfn>screen top</dfn></li>
<li item><kbd>m</kbd> <dfn>screen middle</dfn></li>
<li item><kbd>l</kbd> <dfn>screen bottom</dfn></li>
</ul>
</section>

<section>
<h4>Navigate structurally</h4>
<ul>
<li item><kbd>%</kbd> <dfn>jump to matching "()", "{}", or "[]" pair</dfn></li>
<li item><kbd>}</kbd> <dfn>next paragraph/block</dfn></li>
<li item><kbd>{</kbd> <dfn>previous paragraph/block</dfn></li>
</ul>
</section>

<section>
<h4>Navigate file</h4>
<ul>
<li item><kbd>gg</kbd> <dfn>start of file</dfn></li>
<li item><kbd>g</kbd>  <dfn>end of file</dfn></li>
<li item><kbd>:n</kbd> <dfn>line n of file</dfn></li>
</ul>
</section>

<section>
<h4>Copy/Paste</h4>
<ul>
<li item><kbd>y</kbd>  <dfn>copy selection</dfn></li>
<li item><kbd><kbd>yy</kbd> or <kbd>y</kbd></kbd> <dfn>copy current line</dfn></li>
<li item><kbd>y$</kbd> <dfn>copy to end of line without newline</dfn></li>
<li item><kbd>d</kbd>  <dfn>cut selection</dfn></li>
<li item><kbd>dd</kbd> <dfn>cut line</dfn></li>
<li item><kbd>d</kbd>  <dfn>cut to end of line</dfn></li>
<li item><kbd>p</kbd>  <dfn>paste clipboard after cursor</dfn></li>
<li item><kbd>p</kbd>  <dfn>paste clipboard before cursor</dfn></li>
</ul>
</section>

<section>
<h4>Editing lines</h4>
<ul>
<li item><kbd>j</kbd> <dfn>join next line to current, with space</dfn></li>
<li item><kbd>gj</kbd> <dfn>join next line to current, without space</dfn></li>
<li item><kbd>cc</kbd> <dfn>replace line</dfn></li>
<li item><kbd>c</kbd> <dfn>replace to end of line</dfn></li>
</ul>
</section>

<section>
<h4>Editing characters</h4>
<ul>
<li item><kbd>~</kbd> <dfn>toggle case</dfn></li>
<li item><kbd>x</kbd> <dfn>cut character</dfn></li>
<li item><kbd>xp</kbd> <dfn>transpose</dfn></li>
</ul>
</section>

<section>
<h4>Undo/Redo</h4>
<ul>
<li item><kbd>u</kbd> <dfn>undo</dfn></li>
<li item><kbd>clil</kbd> + <kbd>r</kbd> <dfn>redo</dfn></li>
</ul>
</section>

<section>
<h4>Search/Replace</h4>
<ul>
<li item><kbd>/pattern</kbd> <dfn>search for pattern</dfn></li>
<li item><kbd>?pattern</kbd> <dfn>search for pattern backwards</dfn></li>
<li item><kbd>n</kbd> <dfn>next match</dfn></li>
<li item><kbd>n</kbd> <dfn>previous match</dfn></li>
</ul>
</section>

</main>

<input id="filter" placeholder="filter"></input>

<script>
const show = (node) => node.removeAttribute('hidden');
const hide = (node) => node.setAttribute('hidden', '');
const headingLevel = (heading) => Number(heading.localName[1]);
const normalize = (text) => text.trim().toLowerCase();
const tokenize = (text) => text.split(/\W+/).filter((token) => token !== '');

const filter = (term) => {
  const tokens = tokenize(normalize(term));
  const matchStrings = [];

  const matches = () => {
    for (const token of tokens) {
      let found = false;
      for (const str of matchStrings) {
        if (str.includes(token)) {
          found = true;
          break;
        }
      }
      if (found === false) {
        return false;
      }
    }
    return true;
  };

  const walker =
      document.createTreeWalker(document.body, NodeFilter.SHOW_ELEMENT);
  const headingStack = [];
  const matchStack = [];

  // A heading is visible if any are true:
  //
  // (A1) Any of its ancestor headings already matched.
  // (A2) The concatenation of its text and all ancestor heading text include
  //      all tokens.
  // (A3) Any of its descendant headings matched.
  // (A4) Any of its descendant items matched.
  //
  // An item is visible if any are true:
  //
  // (B1) Any of its ancestor headings already matched.
  // (B2) The concatenation of its text and all ancestor heading text include
  //      all tokens.
  while(walker.nextNode()) {
    const node = walker.currentNode;
    if (node instanceof HTMLHeadingElement) {
      const level = headingLevel(node);
      for (let i = headingStack.length - 1;
           i >= 0 && level <= headingLevel(headingStack[i]); i--) {
        headingStack.pop();
        matchStrings.pop();
        matchStack.pop();
      }
      matchStrings.push(normalize(node.textContent));

      if (matchStack[matchStack.length - 1] === true) {
        show(node); // (A1)
        matchStack.push(true);
      } else if (matches() === true) {
        show(node); // (A2)
        matchStack.push(true);
        for (let ancestor of headingStack) {
          show(ancestor); // (A3)
        }
      } else {
        hide(node);
        matchStack.push(false);
      }

      headingStack.push(node);

    } else if (node.hasAttribute('item')) {
      if (matchStack[matchStack.length - 1] === true) {
        show(node); // (B1)
      } else {
        matchStrings.push(normalize(node.textContent));
        if (matches() === true) {
          show(node); // (B2)
          for (let ancestor of headingStack) {
            show(ancestor); // (A4)
          }
        } else {
          hide(node);
        }
        matchStrings.pop();
      }
    }
  }
};

const input = document.querySelector('#filter');
const url = new URL(document.URL);
const params = url.searchParams;
const term = params.get('q');

if (term) {
  input.value = term;
  filter(term);
}

input.addEventListener('input', () => {
  filter(input.value);
});

document.addEventListener('keypress', () => {
  input.focus();
});

input.focus();
</script>

</body>
</html>